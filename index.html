<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å¼‚æ­¥å¯»å®åŠ¨ç”»</title>
<style>
  :root{
    --bg:#0b0f1a;
    --panel:#121a2b;
    --accent:#f6c453;
    --text:#eaf1ff;
    --muted:#9fb0cc;
    --danger:#ff5c7a;
    --success:#64d38a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background: radial-gradient(1200px 600px at 70% 0%, #10182a, var(--bg));
    color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC", "Noto Sans CJK SC", "Microsoft YaHei", Arial, sans-serif;
  }
  .wrap{
    display:grid;
    grid-template-columns: 1.2fr 1fr;
    gap:16px;
    padding:16px;
    max-width:1100px;
    margin:0 auto;
  }
  @media (max-width: 800px){
    .wrap{grid-template-columns:1fr}
  }

  /* åœºæ™¯èˆå° */
  .stage{
    position:relative;
    background: linear-gradient(#0f1526 55%, #0b0f1a);
    border:1px solid #20304e;
    border-radius:12px;
    overflow:hidden;
    min-height:420px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  .sky{
    position:absolute; inset:0 0 50% 0;
    background: radial-gradient(600px 300px at 60% -10%, #1b2a4a, transparent), linear-gradient(#0f1a31, #0d1527);
  }
  .ground{
    position:absolute; inset:50% 0 0 0;
    background: repeating-linear-gradient(90deg, #0d1526 0 40px, #0a1120 40px 80px);
  }
  /* æ˜Ÿæ˜Ÿ */
  .star{position:absolute; width:2px; height:2px; background:#fff; opacity:.8; border-radius:50%;}
  /* è§’è‰² */
  .hero{
    --x: 10%;
    position:absolute; bottom:18%; left:var(--x);
    width:46px; height:46px; border-radius:8px;
    background: linear-gradient(145deg, #3da1ff, #1a5fb4);
    box-shadow: 0 6px 18px rgba(61,161,255,.35);
    display:grid; place-items:center;
    transform: translateY(0);
    transition: left .8s ease, transform .25s ease;
  }
  .hero::after{
    content:"ğŸ”¦";
    filter: drop-shadow(0 0 8px rgba(246,196,83,.8));
    transform: translateX(6px);
  }
  /* ç«æŠŠå…‰é”¥ */
  .cone{
    position:absolute; bottom:28%; left:calc(var(--x) + 26px);
    width:0; height:0; border-left: 140px solid rgba(246,196,83,.18);
    border-top: 40px solid transparent;
    border-bottom: 40px solid transparent;
    filter: blur(2px);
    transition:left .8s ease;
  }
  /* å®ˆå« */
  .guard{
    position:absolute; bottom:18%; left:64%;
    width:44px; height:44px; border-radius:50%;
    background: linear-gradient(145deg, #e0586b, #7c1e2c);
    box-shadow: 0 6px 18px rgba(224,88,107,.35);
    display:grid; place-items:center;
  }
  .guard::after{content:"ğŸ›¡ï¸"}
  /* æœºå…³é—¨ */
  .door{
    position:absolute; bottom:15%; left:40%;
    width:36px; height:80px;
    background: linear-gradient(#7a6a3a, #4a3e1e);
    border:2px solid #bfa15a; border-radius:6px;
    transform-origin:left center; transform: perspective(200px) rotateY(0deg);
    transition: transform .6s ease;
  }
  .door.open{ transform: perspective(200px) rotateY(-60deg); }
  /* ç®±å­ */
  .chest{
    position:absolute; bottom:16%; left:78%;
    width:56px; height:36px; border-radius:6px;
    background: linear-gradient(#9c5324, #5a2e12);
    border:2px solid #d89a52;
    display:grid; place-items:center;
  }
  .chest::after{content:"ğŸ“¦"}
  .chest.glow{ box-shadow: 0 0 24px 8px rgba(246,196,83,.35) inset, 0 0 18px rgba(246,196,83,.4); }

  /* æ—¥å¿—é¢æ¿ */
  .panel{
    background: var(--panel);
    border:1px solid #20304e;
    border-radius:12px;
    padding:14px;
    min-height:420px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
    display:flex; flex-direction:column;
  }
  .title{font-weight:700; font-size:18px; margin-bottom:8px}
  .log{
    flex:1; overflow:auto; padding:8px; background:rgba(10,16,30,.6);
    border-radius:8px; border:1px solid #1e2a44;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    line-height:1.4; color:var(--muted);
  }
  .log p{margin:.25rem 0}
  .log p.ok{color:var(--success)}
  .log p.err{color:var(--danger)}
  .controls{
    display:flex; gap:8px; margin-top:10px; flex-wrap:wrap
  }
  button{
    background:linear-gradient(180deg, #1a2b4b, #13213a);
    color:var(--text); border:1px solid #28416e; border-radius:8px;
    padding:10px 14px; cursor:pointer; font-weight:600;
  }
  button:hover{filter:brightness(1.08)}
  button:disabled{opacity:.6; cursor:not-allowed}

  /* æç¤ºæ¡ */
  .toast{
    position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
    background:#0f1b32; color:var(--text); border:1px solid #28416e;
    padding:10px 14px; border-radius:8px; opacity:0; pointer-events:none;
    transition: opacity .3s ease, transform .3s ease;
  }
  .toast.show{opacity:1; transform:translateX(-50%) translateY(-8px)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="stage" id="stage">
      <div class="sky"></div>
      <div class="ground"></div>

      <!-- éšæœºæ˜Ÿæ˜Ÿ -->
      <div id="stars"></div>

      <div class="hero" id="hero"></div>
      <div class="cone" id="cone"></div>
      <div class="door" id="door"></div>
      <div class="guard" id="guard"></div>
      <div class="chest" id="chest"></div>
    </div>

    <div class="panel">
      <div class="title">å¼‚æ­¥å¯»å®ä»»åŠ¡</div>
      <div class="log" id="log"></div>
      <div class="controls">
        <button id="run">å¼€å§‹å¯»å®</button>
        <button id="retry" disabled>é‡è¯•</button>
        <button id="skipRand">å…³é—­éšæœºå¤±è´¥</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">å°±ç»ª</div>

<script>
/* å·¥å…·å‡½æ•° */
const sleep = (ms)=> new Promise(r=>setTimeout(r, ms));
const logBox = document.getElementById('log');
const toast = document.getElementById('toast');
function log(msg, type){
  const p = document.createElement('p');
  p.textContent = msg;
  if(type==='ok') p.classList.add('ok');
  if(type==='err') p.classList.add('err');
  logBox.appendChild(p);
  logBox.scrollTop = logBox.scrollHeight;
}
function tip(msg){
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'), 1400);
}

/* æ˜Ÿæ˜Ÿç”Ÿæˆ */
(function makeStars(){
  const stars = document.getElementById('stars');
  for(let i=0;i<90;i++){
    const s = document.createElement('div');
    s.className = 'star';
    s.style.left = Math.random()*100 + '%';
    s.style.top = Math.random()*45 + '%';
    s.style.opacity = (0.4 + Math.random()*0.6).toFixed(2);
    s.style.transform = `scale(${0.6 + Math.random()*1.4})`;
    stars.appendChild(s);
  }
})();

/* è§’è‰²ä¸åœºæ™¯å…ƒç´  */
const hero = document.getElementById('hero');
const cone = document.getElementById('cone');
const door = document.getElementById('door');
const guard = document.getElementById('guard');
const chest = document.getElementById('chest');

function moveHeroTo(percent){
  hero.style.setProperty('--x', percent + '%');
  cone.style.left = `calc(${percent}% + 26px)`;
}

/* åŸå§‹APIä¸æ–°å¢æƒ…èŠ‚ï¼ˆä¸ä¸ŠèŠ‚ä¸€è‡´ï¼Œä½†ä¸ºé¡µé¢ç‹¬ç«‹å®ç°ï¼‰ */
class TreasureMap {
  static getInitialClue(){
    return new Promise(res=>setTimeout(()=>res("åœ¨å¤è€çš„å›¾ä¹¦é¦†é‡Œæ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªçº¿ç´¢..."), 800));
  }
  static decodeAncientScript(clue){
    return new Promise((res, rej)=>setTimeout(()=>{
      if(!clue) return rej("æ²¡æœ‰çº¿ç´¢å¯ä»¥è§£ç !");
      res("è§£ç æˆåŠŸ!å®è—åœ¨ä¸€åº§å¤è€çš„ç¥åº™ä¸­...");
    }, 1000));
  }
  static searchTemple(location){
    return new Promise((res, rej)=>setTimeout(()=>{
      const random = Math.random();
      if(randomFail && random < 0.5) return rej("ç³Ÿç³•!é‡åˆ°äº†ç¥åº™å®ˆå«!");
      res("æ‰¾åˆ°äº†ä¸€ä¸ªç¥ç§˜çš„ç®±å­...");
    }, 1200));
  }
  static openTreasureBox(){
    return new Promise(res=>setTimeout(()=>res("æ­å–œ!ä½ æ‰¾åˆ°äº†ä¼ è¯´ä¸­çš„å®è—!"), 800));
  }
}
class Adventure {
  static consultHistorian(){
    return new Promise(res=>setTimeout(()=>res("å†å²å­¦å®¶æä¾›äº†åæ ‡ä¸é¿å¼€é™·é˜±çš„å°è´´å£«ã€‚"), 700 + Math.random()*400));
  }
  static solveRiddleDoor(){
    return new Promise((res, rej)=>setTimeout(()=>{
      const ok = !randomFail || Math.random() > 0.2;
      if(!ok) return rej("æœºå…³é—¨è°œé¢˜å¤ªå¤æ‚ï¼Œè§£ç­”å¤±è´¥ã€‚");
      res("æœºå…³é—¨å‘å‡ºå’”å“’å£°ï¼Œç¼“ç¼“å¼€å¯ã€‚");
    }, 900));
  }
  static stealthPastGuards(hasTip=true){
    return new Promise((res, rej)=>setTimeout(()=>{
      const base = hasTip ? 0.8 : 0.55;
      const ok = !randomFail || Math.random() < base;
      if(!ok) return rej("è¢«å®ˆå«å‘ç°äº†ï¼åªå¥½æš‚é¿é”‹èŠ’ã€‚");
      res("ä½ è¶ç«æŠŠè½¬è§’æ—¶æ‚„ç„¶é€šè¿‡ã€‚");
    }, 900));
  }
  static disarmTrap(){
    return new Promise((res, rej)=>setTimeout(()=>{
      const ok = !randomFail || Math.random() > 0.15;
      if(!ok) return rej("è§¦å‘äº†æœºå…³ï¼Œç®±å­è¢«å†æ¬¡ä¸Šé”ï¼");
      res("æˆåŠŸè§£é™¤ç®±å­ä¸Šçš„æ¯’é’ˆé™·é˜±ã€‚");
    }, 1000));
  }
  static appraiseTreasure(){
    return new Promise(res=>setTimeout(()=>{
      const real = Math.random() > 0.3;
      res(real ? "é‰´å®šç»“æœï¼šçœŸå“ï¼" : "é‰´å®šç»“æœï¼šèµå“ï¼Œä¸è¿‡ä¹Ÿå¾ˆç²¾ç¾ã€‚");
    }, 700));
  }
  static celebrate(result){
    return new Promise(res=>setTimeout(()=>res(`ç¯ç«æ™šä¼šåº†ç¥ï¼š${result}`), 600));
  }
}

let running = false;
let randomFail = true;

async function animateStep(toPercent){
  moveHeroTo(toPercent);
  await sleep(600);
}

async function runQuest(){
  if(running) return;
  running = true;
  document.getElementById('run').disabled = true;
  document.getElementById('retry').disabled = true;
  logBox.innerHTML = "";
  door.classList.remove('open');
  chest.classList.remove('glow');
  tip("ä»»åŠ¡å¼€å§‹");
  try{
    log("å‡ºå‘ï¼");
    await animateStep(18);

    const clue = await TreasureMap.getInitialClue();
    log(clue, 'ok');

    const tipFromHist = await Adventure.consultHistorian();
    log(tipFromHist, 'ok');

    await animateStep(36);

    const location = await TreasureMap.decodeAncientScript(clue);
    log(location, 'ok');

    log("å°è¯•è§£å¼€æœºå…³é—¨çš„è°œé¢˜...");
    try{
      const doorMsg = await Adventure.solveRiddleDoor();
      door.classList.add('open');
      log(doorMsg, 'ok');
    }catch(e){
      log(e, 'err');
      log("ä½¿ç”¨å†å²å­¦å®¶çš„æç¤ºå†æ¬¡å°è¯•...",);
      const doorMsg = await Adventure.solveRiddleDoor();
      door.classList.add('open');
      log(doorMsg, 'ok');
    }

    await animateStep(48);

    // æ½œè¡Œä¸¤æ¬¡æœºä¼š
    let passed = false;
    for(let i=0;i<2 && !passed;i++){
      try{
        const msg = await Adventure.stealthPastGuards(true);
        log(msg, 'ok');
        passed = true;
      }catch(e){
        log(e, 'err');
        log("è§‚å¯Ÿå®ˆå«åŠ¨å‘ï¼Œå‡†å¤‡å†è¯•ä¸€æ¬¡...");
        await sleep(700);
      }
    }
    if(!passed) throw new Error("å¤šæ¬¡å°è¯•ä»æœªç»•è¿‡å®ˆå«ï¼Œå…ˆæ’¤é€€ã€‚");

    await animateStep(64);

    const box = await TreasureMap.searchTemple(location);
    log(box, 'ok');

    const disarm = await Adventure.disarmTrap();
    log(disarm, 'ok');

    await animateStep(78);

    const treasure = await TreasureMap.openTreasureBox();
    chest.classList.add('glow');
    log(treasure, 'ok');

    const appraisal = await Adventure.appraiseTreasure();
    log(appraisal, appraisal.includes("çœŸå“") ? 'ok' : undefined);

    const finale = await Adventure.celebrate(appraisal.includes("çœŸå“") ? "ä¸¾æ¯åŒåº†ï¼" : "è™½æ˜¯èµå“ï¼Œä¹Ÿä¸è™šæ­¤è¡Œã€‚");
    log(finale, 'ok');
    tip("ä»»åŠ¡å®Œæˆï¼");
  }catch(err){
    log(`ä»»åŠ¡å¤±è´¥: ${err}`, 'err');
    tip("ä»»åŠ¡å¤±è´¥");
  } finally {
    running = false;
    document.getElementById('run').disabled = false;
    document.getElementById('retry').disabled = false;
  }
}

/* äº‹ä»¶ç»‘å®š */
document.getElementById('run').addEventListener('click', runQuest);
document.getElementById('retry').addEventListener('click', runQuest);
document.getElementById('skipRand').addEventListener('click', (e)=>{
  randomFail = !randomFail;
  e.target.textContent = randomFail ? "å…³é—­éšæœºå¤±è´¥" : "å¼€å¯éšæœºå¤±è´¥";
  tip(randomFail ? "å·²å¼€å¯éšæœºäº‹ä»¶" : "å·²å…³é—­éšæœºäº‹ä»¶ï¼ˆæ›´æ˜“æˆåŠŸï¼‰");
});
</script>
</body>
</html>